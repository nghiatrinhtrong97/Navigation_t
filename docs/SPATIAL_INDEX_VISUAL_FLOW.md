# Spatial Index Query - Visual Flow Diagram

## ğŸ”„ LUá»’NG Xá»¬ LÃ HOÃ€N CHá»ˆNH

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER INPUT (Text)                                   â”‚
â”‚                    "123 phá»‘ huáº¿, hÃ  ná»™i"                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 1: ADDRESS PARSING                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AddressParser::parse()                                                 â”‚ â”‚
â”‚  â”‚  Input:  "123 phá»‘ huáº¿, hÃ  ná»™i"                                         â”‚ â”‚
â”‚  â”‚  Output: AddressComponents {                                            â”‚ â”‚
â”‚  â”‚            house_number: "123"                                          â”‚ â”‚
â”‚  â”‚            street_name: "Phá»‘ Huáº¿"                                       â”‚ â”‚
â”‚  â”‚            city: "HÃ  Ná»™i"                                               â”‚ â”‚
â”‚  â”‚            country: "VN"                                                â”‚ â”‚
â”‚  â”‚          }                                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 STEP 2: ADDRESS NORMALIZATION                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AddressNormalizer::normalize()                                         â”‚ â”‚
â”‚  â”‚  - Expand abbreviations: "St" â†’ "Street"                               â”‚ â”‚
â”‚  â”‚  - Uppercase: "phá»‘ huáº¿" â†’ "PHO HUE"                                    â”‚ â”‚
â”‚  â”‚  - Remove diacritics: "Phá»‘" â†’ "PHO"                                    â”‚ â”‚
â”‚  â”‚  - Standardize format                                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â˜…â˜…â˜… STEP 3: ESTIMATE LOCATION (TEXT â†’ COORDINATES) â˜…â˜…â˜…            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Chiáº¿n lÆ°á»£c Æ°á»›c tÃ­nh:                                                   â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  [A] Náº¿u cÃ³ Postal Code:                                                â”‚ â”‚
â”‚  â”‚      zipDatabase.lookup("100000") â†’ {21.028Â°N, 105.850Â°E}             â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  [B] Náº¿u cÃ³ City:                                                       â”‚ â”‚
â”‚  â”‚      cityDatabase.lookup("HÃ  Ná»™i") â†’ {21.028Â°N, 105.850Â°E}            â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  [C] Náº¿u cÃ³ Reference Location (GPS user):                              â”‚ â”‚
â”‚  â”‚      Use current_location: {21.030Â°N, 105.852Â°E}                       â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  [D] Fallback (Default centroid):                                       â”‚ â”‚
â”‚  â”‚      Country center: {16.0Â°N, 108.0Â°E}                                 â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  âœ… OUTPUT: estimated_center = {21.028Â°N, 105.850Â°E}                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          â˜…â˜…â˜… STEP 4: SPATIAL INDEX QUERY (R-TREE) â˜…â˜…â˜…                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Query: findNearestAddresses(estimated_center, k=10)                   â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  Input Coordinates: {21.028Â°N, 105.850Â°E}                              â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  R-tree Traversal (Log N complexity):                                   â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚     Root Node                                                           â”‚ â”‚
â”‚  â”‚       â”‚                                                                  â”‚ â”‚
â”‚  â”‚       â”œâ”€â”€ North Vietnam [21Â°-24Â°N] â† Query point inside! Visit this    â”‚ â”‚
â”‚  â”‚       â”œâ”€â”€ Central [15Â°-18Â°N]       â† Too far, skip                      â”‚ â”‚
â”‚  â”‚       â””â”€â”€ South [8Â°-12Â°N]          â† Too far, skip                      â”‚ â”‚
â”‚  â”‚           â”‚                                                              â”‚ â”‚
â”‚  â”‚           â”œâ”€â”€ HÃ  Ná»™i [20.9Â°-21.1Â°N] â† Query point inside! Visit        â”‚ â”‚
â”‚  â”‚           â”œâ”€â”€ Háº£i PhÃ²ng [20.8Â°-20.9Â°N] â† Maybe check                   â”‚ â”‚
â”‚  â”‚           â””â”€â”€ ...                                                        â”‚ â”‚
â”‚  â”‚               â”‚                                                          â”‚ â”‚
â”‚  â”‚               â”œâ”€â”€ Hai BÃ  TrÆ°ng District â† Contains query point          â”‚ â”‚
â”‚  â”‚               â”œâ”€â”€ HoÃ n Kiáº¿m District                                    â”‚ â”‚
â”‚  â”‚               â””â”€â”€ ...                                                    â”‚ â”‚
â”‚  â”‚                   â”‚                                                      â”‚ â”‚
â”‚  â”‚                   â””â”€â”€ Phá»‘ Huáº¿ Street                                    â”‚ â”‚
â”‚  â”‚                       â”‚                                                  â”‚ â”‚
â”‚  â”‚                       â”œâ”€â”€ 120 Phá»‘ Huáº¿ {21.0283, 105.8495} dist=50m     â”‚ â”‚
â”‚  â”‚                       â”œâ”€â”€ 123 Phá»‘ Huáº¿ {21.0285, 105.8498} dist=85m â˜…   â”‚ â”‚
â”‚  â”‚                       â”œâ”€â”€ 125 Phá»Ÿ Huáº¿ {21.0287, 105.8500} dist=120m    â”‚ â”‚
â”‚  â”‚                       â””â”€â”€ ...                                            â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  âœ… OUTPUT: Top 10 candidates (sorted by distance)                      â”‚ â”‚
â”‚  â”‚     1. "120 Phá»‘ Huáº¿, Hai BÃ  TrÆ°ng" (50m)                               â”‚ â”‚
â”‚  â”‚     2. "123 Phá»‘ Huáº¿, Hai BÃ  TrÆ°ng" (85m)  â† Best match                 â”‚ â”‚
â”‚  â”‚     3. "125 Phá»‘ Huáº¿, Hai BÃ  TrÆ°ng" (120m)                              â”‚ â”‚
â”‚  â”‚     4. "100 Phá»‘ Huáº¿, Hai BÃ  TrÆ°ng" (200m)                              â”‚ â”‚
â”‚  â”‚     ...                                                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               STEP 5: STRING MATCHING & RANKING                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Compare input text with candidates:                                    â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  Input (normalized): "123 PHO HUE HA NOI"                               â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  Candidate 1: "120 PHO HUE HAI BA TRUNG HA NOI"                        â”‚ â”‚
â”‚  â”‚    String similarity: 0.85                                              â”‚ â”‚
â”‚  â”‚    Distance penalty: 1.0 - (50m / 1000m) = 0.95                        â”‚ â”‚
â”‚  â”‚    Final score: 0.85 * 0.7 + 0.95 * 0.3 = 0.595 + 0.285 = 0.88        â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  Candidate 2: "123 PHO HUE HAI BA TRUNG HA NOI" â˜…                      â”‚ â”‚
â”‚  â”‚    String similarity: 0.95  â† House number matches!                    â”‚ â”‚
â”‚  â”‚    Distance penalty: 1.0 - (85m / 1000m) = 0.915                       â”‚ â”‚
â”‚  â”‚    Final score: 0.95 * 0.7 + 0.915 * 0.3 = 0.665 + 0.275 = 0.94       â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  Candidate 3: "125 PHO HUE HAI BA TRUNG HA NOI"                        â”‚ â”‚
â”‚  â”‚    String similarity: 0.90                                              â”‚ â”‚
â”‚  â”‚    Distance penalty: 1.0 - (120m / 1000m) = 0.88                       â”‚ â”‚
â”‚  â”‚    Final score: 0.90 * 0.7 + 0.88 * 0.3 = 0.63 + 0.264 = 0.894        â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  âœ… Best Match: Candidate 2 with score 0.94                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FINAL RESULT (GeocodingCandidate)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  {                                                                       â”‚ â”‚
â”‚  â”‚    formatted_address: "123 Phá»‘ Huáº¿, Hai BÃ  TrÆ°ng, HÃ  Ná»™i",            â”‚ â”‚
â”‚  â”‚    latitude: 21.028511,                                                 â”‚ â”‚
â”‚  â”‚    longitude: 105.849817,                                               â”‚ â”‚
â”‚  â”‚    confidence_score: 0.94,                                              â”‚ â”‚
â”‚  â”‚    match_type: "spatial_proximity",                                     â”‚ â”‚
â”‚  â”‚    geocoding_method: "spatial_index_knn",                               â”‚ â”‚
â”‚  â”‚    accuracy_meters: 10.0,                                               â”‚ â”‚
â”‚  â”‚    quality: STREET_LEVEL                                                â”‚ â”‚
â”‚  â”‚  }                                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ºï¸ R-TREE STRUCTURE VISUALIZATION

### Initial State: Empty R-tree
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     R-tree Root         â”‚
â”‚      (empty)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After Building Index (100,000 addresses):

```
                     Depth 0: Root Node
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Vietnam Bounding Box                      â”‚
        â”‚   [8.0Â°N - 24.0Â°N, 102.0Â°E - 110.0Â°E]      â”‚
        â”‚   Contains: 100,000 addresses               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”â”â”â”â”â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
        â”ƒ                                       â”ƒ
   Depth 1: Regional Nodes                     â”ƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ North Vietnam    â”‚  â”‚  Central     â”‚  â”‚ South Vietnam â”‚
â”‚ [20Â°-24Â°N]       â”‚  â”‚  [15Â°-19Â°N]  â”‚  â”‚ [8Â°-12Â°N]     â”‚
â”‚ 40,000 addresses â”‚  â”‚  20,000 addr â”‚  â”‚ 40,000 addr   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    Depth 2: City Nodes
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼          â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HÃ  Ná»™i â”‚ â”‚Háº£i PhÃ²ngâ”‚    â”‚Nam Äá»‹nhâ”‚
â”‚20,000  â”‚ â”‚ 10,000  â”‚    â”‚ 10,000 â”‚
â”‚addressesâ”‚ â”‚addressesâ”‚    â”‚addressesâ”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
Depth 3: District Nodes
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼           â–¼             â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Ba ÄÃ¬nh â”‚ â”‚HoÃ n Kiáº¿mâ”‚ â”‚Hai BÃ   â”‚    â”‚Äá»‘ng Äa â”‚
â”‚3,000   â”‚ â”‚ 4,000   â”‚ â”‚TrÆ°ng   â”‚    â”‚ 5,000  â”‚
â”‚        â”‚ â”‚         â”‚ â”‚4,000   â”‚    â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    Depth 4: Street Nodes
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼           â–¼             â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚Phá»‘ Huáº¿   â”‚ â”‚Tráº§n  â”‚   â”‚LÃª Duáº©n â”‚
                â”‚150 addr  â”‚ â”‚NhÃ¢n  â”‚   â”‚200 addrâ”‚
                â”‚          â”‚ â”‚TÃ´ng  â”‚   â”‚        â”‚
                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚100   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚        â””â”€â”€â”€â”€â”€â”€â”˜
              Depth 5: Leaf (Actual Addresses)
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼            â–¼            â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚120 Phá»‘â”‚   â”‚123 Phá»‘ â”‚   â”‚125 Phá»‘ â”‚    â”‚130 Phá»‘ â”‚
    â”‚Huáº¿    â”‚   â”‚Huáº¿ â˜…   â”‚   â”‚Huáº¿     â”‚    â”‚Huáº¿     â”‚
    â”‚21.0283â”‚   â”‚21.0285 â”‚   â”‚21.0287 â”‚    â”‚21.0290 â”‚
    â”‚105.850â”‚   â”‚105.850 â”‚   â”‚105.850 â”‚    â”‚105.851 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ QUERY EXAMPLE: "123 Phá»‘ Huáº¿, HÃ  Ná»™i"

### Step-by-Step Tree Traversal:

```
Query Point: {21.0285Â°N, 105.8498Â°E} (estimated from "HÃ  Ná»™i")

â”Œâ”€ Step 1: Start at Root â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  Check children bounding boxes:                              â”‚
â”‚  â€¢ North Vietnam [20Â°-24Â°N] â† Contains query point âœ“         â”‚
â”‚  â€¢ Central [15Â°-19Â°N]       â† Too far south âœ—                â”‚
â”‚  â€¢ South [8Â°-12Â°N]          â† Too far south âœ—                â”‚
â”‚                                                              â”‚
â”‚  Decision: Visit North Vietnam node                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€ Step 2: North Vietnam Node â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  Check children:                                             â”‚
â”‚  â€¢ HÃ  Ná»™i [20.9Â°-21.1Â°N]     â† Contains query âœ“             â”‚
â”‚  â€¢ Háº£i PhÃ²ng [20.8Â°-20.9Â°N]  â† Nearby, check âœ“              â”‚
â”‚  â€¢ Nam Äá»‹nh [20.4Â°-20.6Â°N]   â† Too far âœ—                    â”‚
â”‚                                                              â”‚
â”‚  Decision: Visit HÃ  Ná»™i first (contains point)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€ Step 3: HÃ  Ná»™i Districts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  Calculate distance to each district bounding box:           â”‚
â”‚  â€¢ Hai BÃ  TrÆ°ng [21.02Â°-21.04Â°N] â† distance = 0m âœ“          â”‚
â”‚  â€¢ HoÃ n Kiáº¿m [21.01Â°-21.03Â°N]    â† distance = 500m âœ“        â”‚
â”‚  â€¢ Ba ÄÃ¬nh [21.03Â°-21.05Â°N]      â† distance = 1km âœ“         â”‚
â”‚  â€¢ Äá»‘ng Äa [21.00Â°-21.02Â°N]      â† distance = 1.5km         â”‚
â”‚                                                              â”‚
â”‚  Decision: Visit Hai BÃ  TrÆ°ng (closest)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€ Step 4: Hai BÃ  TrÆ°ng Streets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  Calculate distance to street bounding boxes:                â”‚
â”‚  â€¢ Phá»‘ Huáº¿ [21.027Â°-21.030Â°N]      â† distance = 50m âœ“       â”‚
â”‚  â€¢ Tráº§n NhÃ¢n TÃ´ng [21.025Â°-21.028Â°] â† distance = 300m âœ“     â”‚
â”‚  â€¢ LÃª Duáº©n [21.020Â°-21.025Â°N]       â† distance = 800m       â”‚
â”‚                                                              â”‚
â”‚  Decision: Visit Phá»Ÿ Huáº¿ (closest)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€ Step 5: Addresses on Phá»‘ Huáº¿ (LEAF NODES) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  Calculate exact distances (Haversine formula):              â”‚
â”‚                                                              â”‚
â”‚  1. "120 Phá»Ÿ Huáº¿" {21.02830, 105.84950}                     â”‚
â”‚     distance = 50.2 meters                                   â”‚
â”‚                                                              â”‚
â”‚  2. "123 Phá»‘ Huáº¿" {21.02851, 105.84982} â˜…                   â”‚
â”‚     distance = 85.7 meters                                   â”‚
â”‚                                                              â”‚
â”‚  3. "125 Phá»‘ Huáº¿" {21.02870, 105.85000}                     â”‚
â”‚     distance = 120.3 meters                                  â”‚
â”‚                                                              â”‚
â”‚  4. "130 Phá»Ÿ Huáº¿" {21.02900, 105.85100}                     â”‚
â”‚     distance = 180.5 meters                                  â”‚
â”‚                                                              â”‚
â”‚  Continue searching other nearby streets...                  â”‚
â”‚  (Need k=10 results, currently have 4)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€ Step 6: Backtrack to get more candidates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  Visit Tráº§n NhÃ¢n TÃ´ng street (next closest):                â”‚
â”‚  â€¢ "50 Tráº§n NhÃ¢n TÃ´ng" - distance = 300m                    â”‚
â”‚  â€¢ "100 Tráº§n NhÃ¢n TÃ´ng" - distance = 350m                   â”‚
â”‚  ...                                                         â”‚
â”‚                                                              â”‚
â”‚  Visit HoÃ n Kiáº¿m district (if needed):                       â”‚
â”‚  â€¢ Addresses 500m+ away                                      â”‚
â”‚                                                              â”‚
â”‚  Stop when k=10 candidates found                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€ Final Results: Top 10 Candidates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  1. "120 Phá»Ÿ Huáº¿, Hai BÃ  TrÆ°ng, HÃ  Ná»™i" (50m)              â”‚
â”‚  2. "123 Phá»Ÿ Huáº¿, Hai BÃ  TrÆ°ng, HÃ  Ná»™i" (85m) â˜… BEST       â”‚
â”‚  3. "125 Phá»Ÿ Huáº¿, Hai BÃ  TrÆ°ng, HÃ  Ná»™i" (120m)             â”‚
â”‚  4. "130 Phá»Ÿ Huáº¿, Hai BÃ  TrÆ°ng, HÃ  Ná»™i" (180m)             â”‚
â”‚  5. "50 Tráº§n NhÃ¢n TÃ´ng, Hai BÃ  TrÆ°ng, HÃ  Ná»™i" (300m)       â”‚
â”‚  6. "100 Tráº§n NhÃ¢n TÃ´ng, Hai BÃ  TrÆ°ng, HÃ  Ná»™i" (350m)      â”‚
â”‚  7. "15 Phá»‘ Huáº¿, Hai BÃ  TrÆ°ng, HÃ  Ná»™i" (400m)              â”‚
â”‚  8. "200 Phá»Ÿ Huáº¿, Hai BÃ  TrÆ°ng, HÃ  Ná»™i" (450m)             â”‚
â”‚  9. "10 LÃª Duáº©n, HoÃ n Kiáº¿m, HÃ  Ná»™i" (800m)                 â”‚
â”‚  10. "50 HÃ ng BÃ i, HoÃ n Kiáº¿m, HÃ  Ná»™i" (900m)               â”‚
â”‚                                                              â”‚
â”‚  Nodes Visited: ~7 out of 100,000 addresses                 â”‚
â”‚  Query Time: ~5-10ms (vs 50-100ms linear search)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š PERFORMANCE COMPARISON

### Scenario: Find "123 Phá»‘ Huáº¿, HÃ  Ná»™i" in 100,000 addresses

| Method | Algorithm | Nodes/Records Visited | Time | Scalability |
|--------|-----------|----------------------|------|-------------|
| **Linear Search** | Brute force | 100,000 | 50-100ms | O(n) - Poor |
| **R-tree Spatial Index** | Tree traversal | ~50-100 | 5-10ms | O(log n) - Excellent |

### With 1,000,000 addresses:

| Method | Nodes Visited | Time | Difference |
|--------|---------------|------|-----------|
| Linear | 1,000,000 | 500-1000ms | 10x worse |
| R-tree | ~60-150 | 8-15ms | Only 1.5x slower! |

**Key Insight:** R-tree scales logarithmically, linear search scales linearly!

---

**Document Version:** 1.0  
**Last Updated:** October 19, 2025
